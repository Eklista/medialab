---
title: Workflow - Inventory
description: Flujos de gesti√≥n de inventario, equipos y suministros
---

# Workflow - Inventory

Documentaci√≥n completa de todos los flujos relacionados con gesti√≥n de inventario, desde adquisici√≥n hasta mantenimiento.

## üì¶ **Flujo de Gesti√≥n de Equipos**

### **Fase 1: Registro de Nuevo Equipo**

#### **Trigger**: Llegada de equipo nuevo o registro de existente

```mermaid
graph TD
    A[Equipo llega/necesita registro] --> B[Admin registra datos b√°sicos]
    B --> C[Asignaci√≥n de c√≥digo √∫nico]
    C --> D[Pruebas de funcionamiento]
    D --> E[Estado inicial: DISPONIBLE]
    E --> F[Notificaci√≥n a equipos]
```

**Datos requeridos**:
- `inventory_type_id` - Tipo de equipo (CAMARA, AUDIO, ILUMINACION, etc.)
- `name` - Nombre descriptivo del equipo
- `service_tag` - Etiqueta de servicio (si aplica)
- `serial_number` - N√∫mero de serie del fabricante
- `location` - Ubicaci√≥n f√≠sica actual
- `observations` - Estado inicial y caracter√≠sticas especiales

**Auto-generaci√≥n**:
- `equipment_number` - N√∫mero correlativo autom√°tico por tipo
- `ug_code` - C√≥digo interno de la universidad (si aplica)

#### **Validaciones iniciales**:
- ‚úÖ Serial number no existe previamente
- ‚úÖ Service tag √∫nico (si se proporciona)
- ‚úÖ Tipo de inventario est√° activo
- ‚úÖ Ubicaci√≥n es v√°lida

### **Fase 2: Asignaci√≥n Permanente (Opcional)**

#### **Equipos asignados a usuario espec√≠fico**

```mermaid
graph TD
    A[Admin decide asignaci√≥n permanente] --> B[Validar usuario activo]
    B --> C[Verificar especialidad compatible]
    C --> D[Asignar equipo a usuario]
    D --> E[Estado: EN_USO]
    E --> F[Notificar al usuario]
    F --> G[Registrar en audit_logs]
```

**Criterios para asignaci√≥n permanente**:
- **Laptop personal** ‚Üí Un colaborador espec√≠fico
- **C√°mara especializada** ‚Üí Camar√≥grafo principal
- **Kit de audio** ‚Üí Editor de audio dedicado
- **Herramientas de dise√±o** ‚Üí Dise√±ador espec√≠fico

**Restricciones**:
- ‚úÖ Usuario debe tener especialidad compatible
- ‚úÖ Usuario debe estar activo (no en licencia)
- ‚úÖ Equipo debe estar DISPONIBLE
- ‚úÖ Solo Admin/SuperAdmin puede asignar permanentemente

## üîÑ **Flujo de Reserva para Tareas**

### **Reserva Manual por Admin**

#### **Admin asigna equipo a tarea espec√≠fica**

```mermaid
graph TD
    A[Admin planifica tarea] --> B[Identificar equipos necesarios]
    B --> C[Verificar disponibilidad]
    C --> D{¬øDisponible en fechas?}
    D -->|S√≠| E[Crear reserva]
    D -->|No| F[Mostrar conflictos]
    F --> G[Resolver conflicto o cambiar fechas]
    G --> E
    E --> H[Estado: RESERVADO]
    H --> I[Notificar al colaborador]
```

**Datos de la reserva** (`task_equipment`):
- `task_id` - Tarea que necesita el equipo
- `equipment_id` - Equipo espec√≠fico reservado
- `reserved_from` - Fecha/hora de inicio
- `reserved_to` - Fecha/hora de fin
- `status_id` - Estado de la reserva (RESERVADO)

### **Detecci√≥n de Conflictos**

#### **Validaciones autom√°ticas antes de reservar**:

```sql
-- Verificar si equipo est√° disponible en rango de fechas
SELECT COUNT(*) FROM task_equipment te
JOIN status_options so ON te.status_id = so.id
WHERE te.equipment_id = ? 
  AND so.code IN ('RESERVADO', 'EN_USO')
  AND (
    (te.reserved_from <= ? AND te.reserved_to > ?) OR
    (te.reserved_from < ? AND te.reserved_to >= ?) OR
    (te.reserved_from >= ? AND te.reserved_to <= ?)
  )
```

#### **Tipos de conflictos**:

| Tipo de Conflicto | Descripci√≥n | Resoluci√≥n |
|-------------------|-------------|------------|
| **Solapamiento Total** | Equipo ocupado todo el periodo | Cambiar fechas o equipo |
| **Solapamiento Parcial** | Equipo ocupado parte del periodo | Ajustar horarios |
| **Equipo en Mantenimiento** | No disponible por reparaci√≥n | Usar equipo alternativo |
| **Asignaci√≥n Permanente** | Equipo asignado a otro usuario | Coordinar con usuario |

### **Resoluci√≥n Autom√°tica de Conflictos**

#### **Estrategias de resoluci√≥n**:

1. **Sugerir equipos alternativos** del mismo tipo
2. **Proponer ajuste de horarios** para evitar solapamiento
3. **Mostrar equipos disponibles** en fechas cercanas
4. **Alertar sobre mantenimientos** programados

## ‚è∞ **Flujo de Check-out y Check-in**

### **Check-out: Entrega de Equipo**

#### **Colaborador recoge equipo para usar en tarea**

```mermaid
graph TD
    A[Fecha reserva llega] --> B[Colaborador solicita equipo]
    B --> C[Admin verifica identidad]
    C --> D[Inspecci√≥n estado equipo]
    D --> E[Registrar estado actual]
    E --> F[Entregar a colaborador]
    F --> G[Estado: EN_USO]
    G --> H[Actualizar ubicaci√≥n]
```

**Proceso de check-out**:
1. **Verificaci√≥n de reserva** ‚Üí Confirmar que colaborador tiene reserva activa
2. **Inspecci√≥n visual** ‚Üí Documentar estado actual del equipo
3. **Registro de entrega** ‚Üí Timestamp, usuario, estado observado
4. **Entrega f√≠sica** ‚Üí Colaborador firma recepci√≥n (opcional)
5. **Actualizaci√≥n de sistema** ‚Üí Estado EN_USO, nueva ubicaci√≥n

**Documentaci√≥n requerida**:
- Estado f√≠sico del equipo (rayones, funcionamiento)
- Accesorios incluidos (cables, bater√≠as, estuches)
- Ubicaci√≥n donde se usar√°
- Fecha estimada de devoluci√≥n

### **Check-in: Devoluci√≥n de Equipo**

#### **Colaborador devuelve equipo despu√©s de usar**

```mermaid
graph TD
    A[Tarea completada] --> B[Colaborador devuelve equipo]
    B --> C[Admin inspecciona estado]
    C --> D{¬øEstado OK?}
    D -->|S√≠| E[Estado: DISPONIBLE]
    D -->|Problemas| F[Estado: MANTENIMIENTO]
    E --> G[Actualizar ubicaci√≥n]
    F --> H[Registrar problemas encontrados]
    H --> I[Programar reparaci√≥n]
```

**Validaciones en devoluci√≥n**:
- ‚úÖ Integridad f√≠sica del equipo
- ‚úÖ Funcionamiento b√°sico
- ‚úÖ Accesorios completos
- ‚úÖ Limpieza y cuidado general

#### **Casos especiales en devoluci√≥n**:

**Equipo da√±ado**:
- Estado autom√°tico: `REPARACION`
- Registro detallado del da√±o
- Asignaci√≥n de responsabilidad (si aplica)
- Estimaci√≥n de costo de reparaci√≥n

**Equipo perdido**:
- Estado: `PERDIDO` (nuevo estado)
- Proceso disciplinario si es responsabilidad del usuario
- Reporte a seguros (si aplica)
- Replacement planning

**Devoluci√≥n tard√≠a**:
- Notificaci√≥n autom√°tica +1 d√≠a de retraso
- Escalamiento a Admin +3 d√≠as
- Posible penalizaci√≥n en futuras asignaciones

## üîß **Flujo de Mantenimiento**

### **Mantenimiento Preventivo**

#### **Programaci√≥n autom√°tica basada en uso**

```mermaid
graph TD
    A[Sistema detecta criterio] --> B[Programar mantenimiento]
    B --> C[Notificar responsables]
    C --> D[Bloquear reservas futuras]
    D --> E[Ejecutar mantenimiento]
    E --> F{¬øAprobado?}
    F -->|S√≠| G[Estado: DISPONIBLE]
    F -->|No| H[Estado: REPARACION]
```

**Criterios para mantenimiento preventivo**:
- **Por tiempo**: Cada 6 meses para c√°maras profesionales
- **Por uso**: Cada 100 horas de grabaci√≥n para equipos de video
- **Por proyectos**: Cada 20 proyectos para equipos cr√≠ticos
- **Por fecha**: Mantenimiento anual obligatorio

#### **Proceso de mantenimiento**:
1. **Planificaci√≥n** ‚Üí Identificar ventana de tiempo sin reservas
2. **Notificaci√≥n** ‚Üí Avisar a usuarios frecuentes del equipo
3. **Bloqueo temporal** ‚Üí Impedir nuevas reservas durante mantenimiento
4. **Ejecuci√≥n** ‚Üí Limpieza, calibraci√≥n, actualizaci√≥n firmware
5. **Pruebas** ‚Üí Verificar funcionamiento completo
6. **Documentaci√≥n** ‚Üí Registrar trabajos realizados

### **Mantenimiento Correctivo**

#### **Equipo reportado con problemas**

```mermaid
graph TD
    A[Usuario reporta problema] --> B[Admin eval√∫a severidad]
    B --> C{¬øCr√≠tico?}
    C -->|S√≠| D[Estado: REPARACION inmediata]
    C -->|No| E[Estado: MANTENIMIENTO programado]
    D --> F[Cancelar reservas futuras]
    E --> G[Mantener reservas hasta fecha]
    F --> H[Buscar equipo alternativo]
    G --> H
    H --> I[Ejecutar reparaci√≥n]
    I --> J[Pruebas post-reparaci√≥n]
    J --> K[Estado: DISPONIBLE]
```

**Clasificaci√≥n de problemas**:

| Severidad | Descripci√≥n | Tiempo de Respuesta |
|-----------|-------------|-------------------|
| **Cr√≠tico** | Equipo no funciona | Inmediato |
| **Alto** | Funcionalidad reducida | 24 horas |
| **Medio** | Problemas menores | 1 semana |
| **Bajo** | Mantenimiento cosm√©tico | Pr√≥ximo ciclo |

## üìã **Flujo de Gesti√≥n de Suministros**

### **Control de Stock**

#### **Recepci√≥n de nuevos suministros**

```mermaid
graph TD
    A[Suministros llegan] --> B[Verificar cantidad vs orden]
    B --> C[Registrar en sistema]
    C --> D[Actualizar stock actual]
    D --> E[Verificar fecha vencimiento]
    E --> F[Almacenar en ubicaci√≥n]
    F --> G[Notificar disponibilidad]
```

**Datos registrados** (`supplies`):
- `shipment_number` - N√∫mero de env√≠o del proveedor
- `received_date` - Fecha de recepci√≥n
- `received_by` - Quien recibi√≥ el env√≠o
- `received_quantity` - Cantidad real recibida
- `product_name` - Nombre del producto
- `presentation` - Presentaci√≥n (unidad, caja, etc.)

### **Entrega de Suministros**

#### **Colaborador solicita suministros para proyecto**

```mermaid
graph TD
    A[Colaborador solicita suministros] --> B[Admin verifica disponibilidad]
    B --> C{¬øStock suficiente?}
    C -->|S√≠| D[Registrar entrega]
    C -->|No| E[Notificar falta de stock]
    D --> F[Actualizar stock actual]
    F --> G[Crear registro en supply_deliveries]
    G --> H[Entregar f√≠sicamente]
```

**Control de entregas** (`supply_deliveries`):
- `delivered_to` - A qui√©n se entrega
- `quantity_delivered` - Cantidad entregada
- `delivery_date` - Fecha de entrega
- `notes` - Prop√≥sito o proyecto espec√≠fico

#### **Alertas autom√°ticas de stock**:
- üü° **Stock bajo**: Cuando queda menos del 20% del stock normal
- üî¥ **Stock cr√≠tico**: Cuando queda menos del 5% del stock normal
- ‚ö´ **Sin stock**: Cuando current_stock = 0

## üîç **Flujo de B√∫squeda y Disponibilidad**

### **Consulta de Disponibilidad por Fechas**

#### **Admin busca equipos disponibles para rango espec√≠fico**

```sql
-- Query para encontrar equipos disponibles
SELECT e.*, it.name as type_name
FROM equipment e
JOIN inventory_types it ON e.inventory_type_id = it.id
JOIN status_options so ON e.status_id = so.id
WHERE so.code = 'DISPONIBLE'
  AND e.is_active = true
  AND e.id NOT IN (
    SELECT te.equipment_id 
    FROM task_equipment te
    JOIN status_options so2 ON te.status_id = so2.id
    WHERE so2.code IN ('RESERVADO', 'EN_USO')
      AND te.reserved_from <= ?
      AND te.reserved_to > ?
  )
```

### **B√∫squeda por Especialidad**

#### **Matching autom√°tico equipo-colaborador**

```json
{
  "service_type": "VIDEO_PROMOCIONAL",
  "required_equipment": [
    {"type": "CAMARA", "quantity": 2, "characteristics": ["4K", "stabilization"]},
    {"type": "AUDIO", "quantity": 1, "characteristics": ["lavalier", "wireless"]},
    {"type": "ILUMINACION", "quantity": 3, "characteristics": ["LED", "portable"]}
  ],
  "preferred_collaborators": [
    {"role": "CAMAROGRAFO", "specialties": ["video_4k", "stabilization"]},
    {"role": "TECNICO", "specialties": ["audio_recording", "lighting_setup"]}
  ]
}
```

## üìä **Flujo de Reportes de Inventario**

### **Reportes Autom√°ticos**

#### **Reporte de utilizaci√≥n semanal**

```mermaid
graph TD
    A[Job semanal ejecuta] --> B[Calcular horas de uso por equipo]
    B --> C[Identificar equipos subutilizados]
    C --> D[Detectar equipos sobreutilizados]
    D --> E[Generar reporte de mantenimiento]
    E --> F[Enviar a Admin y SuperAdmin]
```

**M√©tricas calculadas**:
- **Horas de uso por equipo** por semana/mes
- **Porcentaje de utilizaci√≥n** vs capacidad total
- **Equipos m√°s/menos utilizados**
- **Tiempo promedio** entre reservas
- **Eficiencia de mantenimiento** (tiempo fuera de servicio)

#### **Alertas proactivas**:

| M√©trica | Umbral | Acci√≥n |
|---------|--------|--------|
| Utilizaci√≥n mayor al 90% | Semanal | Considerar adquisici√≥n de backup |
| Utilizaci√≥n menor al 10% | Mensual | Evaluar necesidad del equipo |
| Tiempo en reparaci√≥n mayor a 30 d√≠as | Inmediato | Escalar a decisi√≥n de reemplazo |
| Mantenimientos vencidos | Diario | Programar mantenimiento urgente |

### **Dashboard de Inventario en Tiempo Real**

#### **Widgets cr√≠ticos para Admin**:
- **Estado actual de todos los equipos** (gr√°fico de torta)
- **Reservas de hoy y ma√±ana** (calendario compacto)
- **Equipos vencidos para devoluci√≥n** (lista de alertas)
- **Stock bajo de suministros** (tabla con alertas)
- **Mantenimientos pendientes** (lista priorizada)

## üö® **Flujo de Emergencias y Excepciones**

### **Equipo Necesario Urgentemente**

#### **Proyecto urgente necesita equipo ya reservado**

```mermaid
graph TD
    A[Admin identifica necesidad urgente] --> B[Verificar prioridad del proyecto]
    B --> C{¬øPrioridad CR√çTICA?}
    C -->|S√≠| D[Contactar usuario actual]
    C -->|No| E[Buscar alternativas]
    D --> F[Negociar cambio de horario]
    F --> G{¬øUsuario acepta?}
    G -->|S√≠| H[Reasignar reserva]
    G -->|No| I[Escalar a SuperAdmin]
    E --> J[Proponer equipos similares]
```

**Criterios para override de emergencia**:
- ‚úÖ Proyecto marcado como CR√çTICO por SuperAdmin
- ‚úÖ Cliente de alta prioridad (rector, vicerector)
- ‚úÖ Evento con fecha inamovible (graduaci√≥n, conferencia)
- ‚úÖ Emergencia institucional (crisis de comunicaci√≥n)

#### **Proceso de compensaci√≥n**:
1. **Reasignaci√≥n temporal** ‚Üí Ofrecer equipo equivalente o superior
2. **Prioridad futura** ‚Üí Usuario afectado tiene prioridad en pr√≥ximas reservas
3. **Notificaci√≥n transparente** ‚Üí Explicar raz√≥n del cambio
4. **Documentaci√≥n** ‚Üí Registrar en audit_logs con justificaci√≥n

### **Equipo Da√±ado Durante Uso**

#### **Colaborador reporta da√±o durante proyecto**

```mermaid
graph TD
    A[Colaborador reporta da√±o] --> B[Evaluar severidad]
    B --> C{¬øPuede continuar?}
    C -->|S√≠| D[Continuar con precauci√≥n]
    C -->|No| E[Buscar reemplazo inmediato]
    D --> F[Documentar para post-uso]
    E --> G[Verificar disponibilidad backup]
    G --> H{¬øHay backup?}
    H -->|S√≠| I[Entregar equipo alternativo]
    H -->|No| J[Coordinar con otros proyectos]
```

**Equipos cr√≠ticos con backup obligatorio**:
- **C√°mara principal** ‚Üí Siempre tener 1 backup disponible
- **Sistema de audio** ‚Üí Backup para grabaciones importantes
- **Computadora de edici√≥n** ‚Üí Estaci√≥n alternativa disponible

## ‚öôÔ∏è **Configuraciones de Inventario**

### **Configuraciones Cr√≠ticas** (tabla `configurations`)

| Key | Value | Descripci√≥n |
|-----|-------|-------------|
| `inventory.checkout.max_duration_days` | 7 | M√°ximo d√≠as que se puede tener equipo |
| `inventory.maintenance.preventive_hours` | 100 | Horas de uso para mantenimiento preventivo |
| `inventory.alerts.stock_low_percentage` | 20 | Porcentaje para alerta de stock bajo |
| `inventory.alerts.overdue_hours` | 24 | Horas de retraso para alerta |
| `inventory.backup.critical_equipment` | true | Mantener backup de equipos cr√≠ticos |
| `inventory.auto_release.inactive_days` | 3 | D√≠as para liberar reservas no reclamadas |

### **Estados Especiales de Equipos**

#### **Estados adicionales para casos espec√≠ficos**:

| Estado | C√≥digo | Uso | Duraci√≥n |
|--------|--------|-----|----------|
| **PERDIDO** | LOST | Equipo extraviado | Hasta encontrar o declarar p√©rdida total |
| **ROBADO** | STOLEN | Equipo sustra√≠do | Hasta resoluci√≥n legal |
| **OBSOLETO** | OBSOLETE | Equipo muy antiguo | Previo a retiro definitivo |
| **EN_TRANSITO** | IN_TRANSIT | Equipo siendo movido | M√°ximo 24 horas |

### **Roles y Permisos en Inventario**

#### **Matriz de permisos por user_type**:

| Acci√≥n | Cliente | Colaborador | Admin | SuperAdmin |
|--------|---------|-------------|-------|------------|
| **Ver disponibilidad** | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| **Reservar equipo** | ‚ùå | ‚ö†Ô∏è | ‚úÖ | ‚úÖ |
| **Check-out equipo** | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| **Reportar problemas** | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| **Aprobar mantenimiento** | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| **Asignar permanentemente** | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| **Crear/editar equipos** | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| **Dar de baja equipos** | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |

**‚ö†Ô∏è Colaborador puede reservar** solo si:
- ‚úÖ Tiene tarea asignada que requiere el equipo
- ‚úÖ Reserva es para m√°ximo 2 d√≠as en el futuro
- ‚úÖ No tiene equipos vencidos sin devolver

## üîÑ **Integraci√≥n con Otros Flujos**

### **Con Workflow Projects-Tasks**

#### **Reserva autom√°tica basada en tipo de tarea**:

```json
{
  "task_type": "VIDEO_PROMOCIONAL",
  "auto_reserve_equipment": [
    {"type": "CAMARA", "quantity": 1, "duration_hours": 8},
    {"type": "AUDIO", "quantity": 1, "duration_hours": 8},
    {"type": "ILUMINACION", "quantity": 2, "duration_hours": 6}
  ],
  "suggested_collaborators": [
    {"role": "CAMAROGRAFO", "priority": 1},
    {"role": "TECNICO", "priority": 2}
  ]
}
```

### **Con Workflow Users**

#### **Liberaci√≥n autom√°tica en cambio de estado de usuario**:

```sql
-- Trigger cuando usuario pasa a LICENCIA o EX_EMPLEADO
UPDATE equipment 
SET assigned_to_user_id = NULL, status_id = (SELECT id FROM status_options WHERE code = 'DISPONIBLE')
WHERE assigned_to_user_id = ? AND assigned_to_user_id IS NOT NULL;

-- Cancelar reservas futuras
UPDATE task_equipment 
SET status_id = (SELECT id FROM status_options WHERE code = 'CANCELADO')
WHERE equipment_id IN (SELECT id FROM equipment WHERE assigned_to_user_id = ?)
  AND reserved_from > NOW();
```

## üìà **M√©tricas y KPIs de Inventario**

### **KPIs Operacionales**

#### **Eficiencia de utilizaci√≥n**:
- **Utilizaci√≥n promedio** por tipo de equipo
- **Tiempo de inactividad** por mantenimiento
- **Porcentaje de reservas completadas** vs canceladas
- **Tiempo promedio** de check-out a check-in

#### **KPIs de servicio**:
- **Disponibilidad cuando se necesita** (porcentaje de veces que hay equipo disponible)
- **Tiempo de respuesta** para mantenimiento correctivo
- **Porcentaje de equipos en buen estado** (sin problemas reportados)
- **Satisfacci√≥n de usuarios** con disponibilidad de equipos

### **Alertas de Performance**

#### **Umbrales cr√≠ticos**:
- üî¥ **Cr√≠tico**: Disponibilidad menor al 70% para equipos cr√≠ticos
- üü° **Atenci√≥n**: M√°s del 20% equipos en mantenimiento simult√°neo
- üü¢ **Normal**: M√©tricas dentro de rangos objetivo
- ‚≠ê **Excelente**: M√°s del 95% disponibilidad y menos del 5% tiempo en reparaci√≥n

## üîß **Jobs Autom√°ticos de Inventario**

### **Jobs Diarios**
- **08:00** - Verificar devoluciones vencidas y enviar recordatorios
- **12:00** - Actualizar stock de suministros y alertas
- **18:00** - Preparar reportes de equipos para ma√±ana

### **Jobs Semanales**
- **Domingo 22:00** - Reporte de utilizaci√≥n semanal
- **Lunes 06:00** - Planificaci√≥n de mantenimientos preventivos
- **Viernes 17:00** - Reporte de inventario para fin de semana

### **Jobs Mensuales**
- **√öltimo d√≠a 23:00** - Archivado de registros antiguos
- **Primer d√≠a 06:00** - Reporte mensual de m√©tricas
- **D√≠a 15** - Auditor√≠a de inventario y discrepancias

---

**Relacionado con**:
- [Workflow Users](/documentacion-tecnica/workflows/workflow-users) - Para asignaciones permanentes y liberaci√≥n de equipos
- [Workflow Projects-Tasks](/documentacion-tecnica/workflows/workflow-projects-tasks) - Para reservas autom√°ticas seg√∫n tipo de tarea