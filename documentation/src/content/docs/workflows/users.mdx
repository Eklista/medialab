---
title: Workflow - Users
description: Flujos de gesti√≥n de usuarios, roles y seguridad
---

# Workflow - Users

Documentaci√≥n completa de todos los flujos relacionados con gesti√≥n de usuarios, desde onboarding hasta desactivaci√≥n.

## üë§ **Flujo de Onboarding - Nuevo Usuario**

### **Fase 1: Creaci√≥n de Usuario**

#### **Trigger**: Admin o SuperAdmin crea nuevo usuario

```mermaid
graph TD
    A[Admin crea usuario] --> B[Datos b√°sicos requeridos]
    B --> C[Asignaci√≥n de tipo de usuario]
    C --> D[Usuario creado con estado PENDIENTE]
    D --> E[Email de activaci√≥n enviado]
```

**Datos requeridos**:
- `name` - Nombre completo
- `email` - Email √∫nico institucional
- `user_type_id` - Tipo de usuario (CLIENT, COLLABORATOR, ADMIN, SUPERADMIN)
- `unit_id` - Unidad organizacional (solo internos)
- `employee_role_id` - Rol espec√≠fico (solo internos)

**Estados iniciales**:
- `is_active` = `true`
- `email_verified` = `false`
- `is_internal` = `true/false` (seg√∫n user_type)

#### **Validaciones autom√°ticas**:
- ‚úÖ Email no existe previamente
- ‚úÖ Unidad existe y est√° activa
- ‚úÖ Rol es compatible con tipo de usuario
- ‚úÖ Permisos del creador para asignar ese tipo

### **Fase 2: Activaci√≥n de Cuenta**

#### **Usuario recibe email con token de activaci√≥n**

```mermaid
graph TD
    A[Usuario click en link] --> B[Validar token]
    B --> C{¬øToken v√°lido?}
    C -->|S√≠| D[Formulario completar perfil]
    C -->|No| E[Error - Solicitar nuevo token]
    D --> F[Usuario completa datos]
    F --> G[email_verified = true]
    G --> H[Redirecci√≥n a dashboard correspondiente]
```

**Datos adicionales a completar**:
- `password` - Contrase√±a segura
- `phone` - Tel√©fono de contacto
- `avatar_url` - Foto de perfil (opcional)
- `specialties` - Especialidades t√©cnicas (solo colaboradores)

**Validaciones**:
- ‚úÖ Contrase√±a cumple pol√≠ticas de seguridad
- ‚úÖ Tel√©fono en formato v√°lido
- ‚úÖ Avatar URL es accesible (si se proporciona)

#### **Post-activaci√≥n autom√°tica**:
1. **Registro de dispositivo** ‚Üí `user_devices` con device fingerprint
2. **Notificaci√≥n a Admin** ‚Üí Usuario activado correctamente
3. **Configuraci√≥n de preferencias por defecto** ‚Üí `user_notification_preferences`
4. **Asignaci√≥n de permisos** ‚Üí Seg√∫n `user_type.permissions`

### **Fase 3: Configuraci√≥n Inicial (Solo Colaboradores)**

#### **Asignaci√≥n de Especialidades**

```json
{
  "CAMAROGRAFO": {
    "equipment": ["CAMARA_DSLR", "CAMARA_VIDEO", "ESTABILIZADOR"],
    "skills": ["grabacion_video", "fotografia", "streaming_live"],
    "certifications": ["drone_license", "lighting_basic"]
  },
  "EDITOR": {
    "software": ["premiere_pro", "after_effects", "davinci_resolve"],
    "specialties": ["color_grading", "audio_mixing", "motion_graphics"],
    "output_formats": ["4K", "HD", "social_media", "web"]
  },
  "DISE√ëADOR": {
    "software": ["photoshop", "illustrator", "figma", "indesign"],
    "specialties": ["graphic_design", "ui_ux", "branding", "print_design"],
    "output_types": ["digital", "print", "web", "social_media"]
  }
}
```

#### **Asignaci√≥n de Equipos Permanentes** (opcional)
- Laptop personal del colaborador
- C√°mara asignada espec√≠ficamente
- Accesorios de uso personal

## üîÑ **Flujo de Cambio de Roles**

### **Promoci√≥n: Colaborador ‚Üí Admin**

#### **Trigger**: SuperAdmin decide promoci√≥n

```mermaid
graph TD
    A[SuperAdmin inicia cambio] --> B[Validar prerequisites]
    B --> C[Backup de configuraci√≥n actual]
    C --> D[Actualizar user_type_id]
    D --> E[Migrar permisos]
    E --> F[Notificar al usuario]
    F --> G[Audit log del cambio]
```

**Prerequisites validados**:
- ‚úÖ Usuario tiene al menos 6 meses en el sistema
- ‚úÖ No tiene tareas cr√≠ticas pendientes
- ‚úÖ Performance rating mayor a 4.0 (si existe sistema de rating)

**Migraci√≥n autom√°tica**:
1. **Permisos expandidos** ‚Üí De COLLABORATOR a ADMIN permissions
2. **Dashboard access** ‚Üí Mantiene `/dashboard/` pero con funciones admin
3. **Notificaciones** ‚Üí Recibe alertas de gesti√≥n de proyectos
4. **Equipos asignados** ‚Üí Se mantienen los asignados permanentemente

**Periodo de transici√≥n** (30 d√≠as):
- Usuario puede acceder a funciones admin gradualmente
- Mentor asignado (otro admin) para capacitaci√≥n
- Monitoreo especial de acciones cr√≠ticas

### **Degradaci√≥n: Admin ‚Üí Colaborador**

#### **Trigger**: Decisi√≥n disciplinaria o reorganizaci√≥n

**Proceso m√°s cuidadoso**:
1. **Evaluaci√≥n de dependencias** ‚Üí ¬øQu√© proyectos gestiona actualmente?
2. **Reasignaci√≥n gradual** ‚Üí Transferir responsabilidades a otro admin
3. **Revocaci√≥n de permisos** ‚Üí Paso a paso, no abrupto
4. **Notificaci√≥n a equipo** ‚Üí Transparencia en el cambio
5. **Plan de retenci√≥n** ‚Üí Evitar que se vaya de la empresa

## üö´ **Flujo de Desactivaci√≥n de Usuario**

### **Desactivaci√≥n Temporal (Licencia/Vacaciones)**

#### **Estados especiales para colaboradores**:

| Estado | Login | Asignaciones | Equipos | Notificaciones |
|--------|-------|--------------|---------|----------------|
| **VACACIONES** | ‚úÖ | Solo lectura | Mantiene | Reducidas |
| **LICENCIA** | ‚ùå | Reasignables | Libera temporales | Pausadas |
| **SUSPENSION** | ‚ùå | Pausadas | Libera todos | Pausadas |

#### **Proceso autom√°tico en cambio a LICENCIA**:

```mermaid
graph TD
    A[Admin marca usuario LICENCIA] --> B[Identificar tareas activas]
    B --> C[Notificar a otros colaboradores]
    C --> D[Liberar equipos temporales]
    D --> E[Pausar notificaciones]
    E --> F[Programar fecha de retorno]
    F --> G[Audit log con duraci√≥n esperada]
```

**Equipos liberados autom√°ticamente**:
- ‚úÖ Equipos reservados para tareas espec√≠ficas
- ‚úÖ Equipos temporales (proyectores, c√°maras grandes)
- ‚ùå Equipos permanentes (laptop personal, c√°mara asignada)

### **Desactivaci√≥n Permanente (Ex-empleado)**

#### **Proceso de Ex-empleado**

```mermaid
graph TD
    A[SuperAdmin inicia proceso] --> B[Verificar proyectos activos]
    B --> C{¬øTiene proyectos cr√≠ticos?}
    C -->|S√≠| D[Reasignar gradualmente]
    C -->|No| E[Desactivaci√≥n inmediata]
    D --> F[Finalizar reasignaciones]
    F --> E
    E --> G[Bloquear login permanentemente]
    G --> H[Liberar todos los equipos]
    H --> I[Preservar historial]
    I --> J[Marcar como EX_EMPLEADO]
```

**Preservaci√≥n de historial**:
- ‚úÖ Todas las tareas quedan como "Creado por [Nombre] (Ex-empleado)"
- ‚úÖ Proyectos liderados quedan con nota hist√≥rica
- ‚úÖ Audit logs se mantienen √≠ntegros
- ‚úÖ Comentarios y feedback previo se preserva

**Liberaci√≥n de recursos**:
- ‚úÖ Todos los equipos ‚Üí Estado DISPONIBLE
- ‚úÖ Tareas activas ‚Üí Reasignadas a otros colaboradores
- ‚úÖ Reservas futuras ‚Üí Canceladas autom√°ticamente
- ‚úÖ Accesos y dispositivos ‚Üí Revocados

## üîê **Flujo de Gesti√≥n de Dispositivos**

### **Registro de Nuevo Dispositivo**

#### **Usuario hace login desde dispositivo desconocido**

```mermaid
graph TD
    A[Login desde nuevo dispositivo] --> B[Capturar device fingerprint]
    B --> C[Generar device_id √∫nico]
    C --> D[Almacenar en user_devices]
    D --> E[Enviar email de verificaci√≥n]
    E --> F[Usuario confirma dispositivo]
    F --> G[Marcar como is_trusted = true]
```

**Informaci√≥n capturada autom√°ticamente**:
- `device_fingerprint` - Hash √∫nico del dispositivo
- `browser` - Navegador utilizado
- `os` - Sistema operativo detectado
- `ip_address` - IP de acceso
- `user_agent` - String completo del user agent

#### **Dispositivo no verificado (primeras 48 horas)**:
- ‚ö†Ô∏è Sesi√≥n limitada a 2 horas
- ‚ö†Ô∏è Funciones cr√≠ticas bloqueadas
- ‚ö†Ô∏è Notificaciones adicionales de seguridad

#### **Dispositivo confiable (verificado)**:
- ‚úÖ Sesi√≥n extendida (30 d√≠as)
- ‚úÖ Login autom√°tico recordado
- ‚úÖ Acceso completo a funcionalidades

### **Detecci√≥n de Actividad Sospechosa**

#### **Patrones que disparan alertas**:

| Patr√≥n | Umbral | Acci√≥n Autom√°tica |
|--------|--------|-------------------|
| M√∫ltiples logins fallidos | 5 en 10 min | Bloquear usuario 30 min |
| Login desde nuevo pa√≠s | Inmediato | Email de verificaci√≥n |
| M√∫ltiples dispositivos simult√°neos | 3 o m√°s activos | Alertar usuario |
| Cambio s√∫bito de ubicaci√≥n | M√°s de 500km en menos de 1h | Verificaci√≥n adicional |

#### **Escalamiento de seguridad**:

```mermaid
graph TD
    A[Actividad sospechosa detectada] --> B[Nivel de riesgo]
    B --> C{¬øNivel cr√≠tico?}
    C -->|Alto| D[Bloqueo inmediato + Admin alert]
    C -->|Medio| E[Verificaci√≥n adicional requerida]
    C -->|Bajo| F[Log de seguridad + Monitoreo]
```

## üîî **Flujo de Notificaciones de Usuario**

### **Configuraci√≥n de Preferencias**

#### **Preferencias por defecto seg√∫n user_type**:

```json
{
  "CLIENT": {
    "task_updates": {"email": true, "in_app": true},
    "project_milestones": {"email": true, "in_app": true},
    "system_alerts": {"email": false, "in_app": true}
  },
  "COLLABORATOR": {
    "task_assignments": {"email": true, "in_app": true},
    "deadline_reminders": {"email": true, "in_app": true},
    "equipment_alerts": {"email": false, "in_app": true}
  },
  "ADMIN": {
    "all_collaborator_notifications": true,
    "request_alerts": {"email": true, "in_app": true},
    "system_issues": {"email": true, "in_app": true}
  },
  "SUPERADMIN": {
    "all_notifications": true,
    "security_alerts": {"email": true, "in_app": true, "webhook": true},
    "system_critical": {"email": true, "in_app": true, "webhook": true}
  }
}
```

#### **Personalizaci√≥n por usuario**:
- Usuario puede ajustar cada tipo de notificaci√≥n individualmente
- Horarios de "no molestar" configurables
- Frecuencia: Inmediata, Resumen diario, Resumen semanal
- Canales preferidos por tipo de evento

### **Flujo de Escalamiento por User Type**

#### **Escalamiento autom√°tico por inactividad**:

| User Type | Sin actividad | Acci√≥n |
|-----------|---------------|--------|
| CLIENT | 30 d√≠as | Email recordatorio proyecto |
| COLLABORATOR | 5 d√≠as | Notificar Admin |
| ADMIN | 3 d√≠as | Notificar SuperAdmin |
| SUPERADMIN | 7 d√≠as | Alerta cr√≠tica |

## üìä **M√©tricas de Usuario**

### **KPIs por Tipo de Usuario**

#### **Colaboradores**:
- **Tiempo promedio de respuesta** a asignaciones
- **Porcentaje de tareas completadas a tiempo**
- **Calidad promedio** de entregables (rating)
- **Utilizaci√≥n de equipos** asignados

#### **Administradores**:
- **Tiempo promedio de evaluaci√≥n** de solicitudes
- **Porcentaje de proyectos entregados a tiempo** bajo su gesti√≥n
- **Satisfacci√≥n promedio** de clientes

#### **Clientes**:
- **Tiempo promedio de feedback** en revisiones
- **Porcentaje de aprobaciones** en primera revisi√≥n
- **Satisfacci√≥n** con servicios recibidos

### **Alertas de Performance**

#### **Indicadores de riesgo por usuario**:
- üî¥ **Cr√≠tico**: KPI m√°s del 50% por debajo de promedio
- üü° **Atenci√≥n**: KPI 20-50% por debajo de promedio
- üü¢ **Normal**: KPI dentro del rango esperado
- ‚≠ê **Excelente**: KPI m√°s del 20% por encima de promedio

## ‚öôÔ∏è **Configuraciones de Usuario**

### **Configuraciones Cr√≠ticas** (tabla `configurations`)

| Key | Value | Descripci√≥n |
|-----|-------|-------------|
| `users.onboarding.token_expiry` | 72 | Horas para activar cuenta |
| `users.password.min_length` | 8 | Longitud m√≠nima de contrase√±a |
| `users.password.require_symbols` | true | Requerir s√≠mbolos especiales |
| `users.session.timeout_hours` | 8 | Timeout de sesi√≥n inactiva |
| `users.device.verification_required` | true | Verificar nuevos dispositivos |
| `users.security.max_failed_attempts` | 5 | Intentos antes de bloqueo temporal |
| `users.escalation.inactive_days` | 7 | D√≠as sin actividad para alertar |

### **Validaciones de Integridad**

#### **Jobs autom√°ticos de mantenimiento**:
- **Diario**: Verificar usuarios con dispositivos hu√©rfanos
- **Semanal**: Detectar cuentas inactivas por tipo
- **Mensual**: Limpiar tokens expirados y sesiones antigas
- **Trimestral**: Auditor√≠a de permisos vs funciones reales

---

**Relacionado con**:
- [Workflow Projects-Tasks](/documentacion-tecnica/workflows/workflow-projects-tasks) - Para asignaciones y colaboraci√≥n
- [Workflow Inventory](/documentacion-tecnica/workflows/workflow-inventory) - Para gesti√≥n de equipos por usuario