---
title: Workflow - Configuration
description: Gesti√≥n de configuraciones del sistema y rollback
---

# Workflow - Configuration

Sistema de gesti√≥n de configuraciones del sistema con backup autom√°tico, validaciones y capacidad de rollback para cambios cr√≠ticos.

## ‚öôÔ∏è **Concepto General de Configuraci√≥n**

### **Principio B√°sico**
**Nada hardcodeado** - Todo configurable desde la base de datos con **backup autom√°tico**, **validaciones estrictas** y **rollback inmediato** si algo sale mal.

### **Flujo Principal de Cambio de Configuraci√≥n**
```mermaid
graph TD
    A[SuperAdmin quiere cambiar config] --> B[Validar permisos]
    B --> C[Backup autom√°tico del valor actual]
    C --> D[Validar nuevo valor]
    D --> E{¬øValidaci√≥n OK?}
    E -->|No| F[Mostrar errores y cancelar]
    E -->|S√≠| G[Aplicar cambio]
    G --> H[Registrar en configuration_history]
    H --> I[Monitorear sistema por 5 minutos]
    I --> J{¬øSistema estable?}
    J -->|No| K[Rollback autom√°tico]
    J -->|S√≠| L[Confirmar cambio exitoso]
```

## üîß **Tipos de Configuraciones**

### **Por Criticidad**

#### **Cr√≠ticas (Nivel 1)**
Pueden **romper el sistema** si se configuran mal:
- **Configuraciones de base de datos** (conexiones, pools)
- **URLs de servicios externos** cr√≠ticos
- **Configuraciones de seguridad** (JWT secrets, encryption keys)
- **L√≠mites de sistema** (memory, connections)

**Caracter√≠sticas**:
- Requieren **confirmaci√≥n doble**
- **Backup autom√°tico** antes del cambio
- **Monitoreo autom√°tico** post-cambio
- **Rollback autom√°tico** si detecta problemas

#### **Importantes (Nivel 2)**
Afectan **funcionalidad principal**:
- **Timeouts de workflows** (evaluaci√≥n, revisi√≥n, etc.)
- **L√≠mites de usuarios** (archivos, sesiones)
- **Configuraciones de notificaciones**
- **Estados y flujos** de trabajo

**Caracter√≠sticas**:
- Requieren **justificaci√≥n** del cambio
- **Backup autom√°tico**
- **Validaci√≥n estricta** de valores
- **Rollback manual** disponible

#### **Normales (Nivel 3)**
Afectan **experiencia de usuario**:
- **Colores e iconos** del sistema
- **Textos de interfaz**
- **Configuraciones de reportes**
- **Preferencias por defecto**

**Caracter√≠sticas**:
- **Validaci√≥n b√°sica**
- **Historial** de cambios
- **Rollback** disponible por 30 d√≠as

#### **Cosm√©tica (Nivel 4)**
Solo afectan **apariencia**:
- **Logos e im√°genes**
- **Colores secundarios**
- **Textos informativos**

**Caracter√≠sticas**:
- **Cambio inmediato**
- **Historial b√°sico**

## üõ°Ô∏è **Sistema de Validaciones**

### **Validaciones por Tipo de Dato**

#### **URLs y Endpoints**
- **Formato v√°lido**: Protocolo, dominio, puerto
- **Accesibilidad**: Ping b√°sico para verificar conexi√≥n
- **Certificados SSL**: Validar si es HTTPS
- **Timeout test**: Verificar que responde en tiempo razonable

#### **N√∫meros y L√≠mites**
- **Rangos v√°lidos**: Min/max seg√∫n el contexto
- **Tipo correcto**: Integer, float, etc.
- **Dependencias**: Que sea coherente con otros valores
- **Performance**: Que no afecte rendimiento del sistema

#### **Textos y Strings**
- **Longitud**: Min/max caracteres
- **Caracteres permitidos**: No scripts maliciosos
- **Encoding**: UTF-8 v√°lido
- **Contexto**: Apropiado para su uso

#### **Configuraciones de Tiempo**
- **Formato v√°lido**: D√≠as, horas, minutos
- **Rangos l√≥gicos**: No negativos, no excesivamente largos
- **Coherencia**: Entre timeouts relacionados
- **Zona horaria**: Consistencia en el sistema

### **Validaciones de Dependencias**

#### **Configuraciones Relacionadas**
- **Timeout de revisi√≥n** no puede ser mayor que **timeout de proyecto**
- **L√≠mite de archivos** debe ser coherente con **l√≠mite de storage**
- **Configuraciones de email** deben tener **servidor SMTP** v√°lido

#### **Validaciones de Negocio**
- **Estados de workflow** deben mantener **flujo l√≥gico**
- **Roles de usuario** deben tener **permisos coherentes**
- **Tipos de servicio** deben tener **categor√≠as v√°lidas**

## üì¶ **Sistema de Backup y Historial**

### **Backup Autom√°tico**

#### **Antes de Cada Cambio**
```mermaid
graph TD
    A[Usuario inicia cambio] --> B[Crear snapshot completo]
    B --> C[Guardar en configuration_history]
    C --> D[Verificar backup exitoso]
    D --> E[Proceder con cambio]
    E --> F[Marcar backup como punto de restauraci√≥n]
```

#### **Informaci√≥n del Backup**
- **Timestamp exacto** del backup
- **Usuario** que realiz√≥ el cambio
- **Valor anterior** completo
- **Raz√≥n del cambio** (opcional pero recomendado)
- **Estado del sistema** en ese momento

### **Historial Completo**

#### **Para Cada Cambio se Registra**
- **Qui√©n**: Usuario que hizo el cambio
- **Qu√©**: Configuraci√≥n espec√≠fica modificada
- **Cu√°ndo**: Timestamp exacto
- **Desde/Hasta**: Valor anterior y nuevo
- **Por qu√©**: Raz√≥n del cambio
- **C√≥mo**: Interfaz usada (Web UI, API, etc.)

#### **Metadatos Adicionales**
- **IP y dispositivo** desde donde se hizo
- **Tiempo de aplicaci√≥n** del cambio
- **Validaciones ejecutadas** y resultados
- **Estado post-cambio** del sistema

## üîÑ **Sistema de Rollback**

### **Rollback Autom√°tico**

#### **Triggers para Rollback Autom√°tico**
- **Error 500** en endpoints cr√≠ticos por m√°s de 2 minutos
- **Base de datos** no responde en 30 segundos
- **Servicios externos** fallan por timeout configurado
- **Memoria o CPU** por encima del 95% por 5 minutos

#### **Proceso Autom√°tico**
```mermaid
graph TD
    A[Sistema detecta problema] --> B[Verificar si fue cambio reciente]
    B --> C{¬øCambio en √∫ltimos 10 min?}
    C -->|S√≠| D[Iniciar rollback autom√°tico]
    C -->|No| E[Alerta normal de sistema]
    D --> F[Restaurar configuraci√≥n anterior]
    F --> G[Reiniciar servicios afectados]
    G --> H[Verificar estabilidad]
    H --> I[Notificar a SuperAdmin]
```

### **Rollback Manual**

#### **Rollback con Un Click**
- **Interfaz simple**: Lista de cambios recientes con bot√≥n "Deshacer"
- **Vista previa**: Qu√© va a cambiar exactamente
- **Confirmaci√≥n**: "¬øEst√°s seguro?" con detalles del impacto
- **Ejecuci√≥n**: Aplicaci√≥n inmediata con monitoreo

#### **Rollback Selectivo**
- **Cambios m√∫ltiples**: Poder elegir cu√°les deshacer
- **Configuraciones relacionadas**: Advertir sobre dependencias
- **Vista de diferencias**: Before/after claro
- **Simulaci√≥n**: Dry-run antes de aplicar

### **Rollback de Emergencia**

#### **Para Situaciones Cr√≠ticas**
- **Bot√≥n de p√°nico**: Rollback a √∫ltimo estado estable conocido
- **Sin confirmaciones**: Acci√≥n inmediata
- **Notificaci√≥n masiva**: A todo el equipo t√©cnico
- **Log cr√≠tico**: Registro especial del evento

## üîç **Monitoreo Post-Cambio**

### **Monitoreo Autom√°tico**

#### **M√©tricas Monitoreadas**
- **Tiempo de respuesta** de endpoints cr√≠ticos
- **Errores 4xx y 5xx** en API
- **Uso de memoria y CPU** del servidor
- **Conexiones a base de datos** activas
- **Logs de error** del sistema

#### **Umbrales de Alerta**
- **Tiempo de respuesta** mayor a 3 segundos
- **Tasa de errores** mayor al 5%
- **Uso de memoria** mayor al 85%
- **Errores en logs** m√°s de 10 en 5 minutos

### **Per√≠odos de Monitoreo**

#### **Cr√≠ticas**: 30 minutos de monitoreo intensivo
- Verificaci√≥n cada 30 segundos
- Rollback autom√°tico si detecta problemas
- Alerta inmediata a SuperAdmin

#### **Importantes**: 10 minutos de monitoreo
- Verificaci√≥n cada 2 minutos
- Alerta si detecta problemas
- Rollback manual disponible

#### **Normales**: 5 minutos de verificaci√≥n
- Verificaci√≥n cada 5 minutos
- Log si detecta problemas menores

## üë• **Permisos y Roles**

### **SuperAdmin**
- **Acceso completo** a todas las configuraciones
- **Puede hacer rollback** de cualquier cambio
- **Recibe alertas** de todos los problemas
- **Puede configurar** niveles de criticidad

### **Admin**
- **Solo configuraciones Nivel 3 y 4** (normales y cosm√©tica)
- **Puede ver historial** de cambios
- **Puede sugerir cambios** cr√≠ticos (requieren aprobaci√≥n)
- **No puede hacer rollback** de cambios cr√≠ticos

### **Colaborador y Cliente**
- **Solo pueden ver** configuraciones que les afectan
- **Pueden sugerir mejoras** a trav√©s de feedback
- **No pueden modificar** ninguna configuraci√≥n del sistema

## üìä **Reportes y An√°lisis**

### **Dashboard de Configuraciones**

#### **Para SuperAdmin**
- **Cambios recientes** con estado de monitoreo
- **Configuraciones cr√≠ticas** y su estado actual
- **Alertas activas** del sistema
- **Uso de rollbacks** en el √∫ltimo mes

#### **M√©tricas Importantes**
- **Tiempo promedio** entre cambio y estabilidad confirmada
- **Porcentaje de rollbacks** autom√°ticos vs manuales
- **Configuraciones m√°s cambiadas** en el √∫ltimo per√≠odo
- **Usuarios m√°s activos** haciendo cambios

### **Reportes de Auditoria**

#### **Reporte Mensual**
- **Todos los cambios** realizados en el mes
- **Rollbacks ejecutados** y sus razones
- **Tiempo de inactividad** causado por cambios
- **Recomendaciones** para mejorar estabilidad

#### **Reporte de Incidentes**
- **Cambios que causaron problemas**
- **Tiempo de detecci√≥n** y resoluci√≥n
- **Lecciones aprendidas**
- **Mejoras implementadas** en validaciones

## üîÑ **Integraci√≥n con Otros Workflows**

### **Con Security & Audit**
- **Todos los cambios** se registran en audit_logs
- **Cambios cr√≠ticos** generan alertas de seguridad
- **Rollbacks** se auditan con m√°xima prioridad
- **Accesos no autorizados** a configuraciones se bloquean

### **Con Notifications**
- **Cambios cr√≠ticos** notifican a SuperAdmin inmediatamente
- **Rollbacks autom√°ticos** generan alertas cr√≠ticas
- **Problemas post-cambio** escalan autom√°ticamente
- **Configuraciones de notificaci√≥n** son parte del sistema

### **Con Users**
- **Permisos de configuraci√≥n** se basan en user_type
- **Cambios de usuarios** pueden requerir ajustes de configuraci√≥n
- **Historial de cambios** se relaciona con usuarios espec√≠ficos

## üöÄ **Casos Especiales**

### **Deploy de Nueva Versi√≥n**
- **Backup completo** de todas las configuraciones antes del deploy
- **Validaci√≥n extendida** de configuraciones despu√©s del deploy
- **Plan de rollback** espec√≠fico para versiones
- **Configuraciones nuevas** con valores por defecto seguros

### **Migraciones de Datos**
- **Configuraciones relacionadas** con estructura de datos
- **Backup especial** antes de migraciones complejas
- **Validaci√≥n post-migraci√≥n** de configuraciones
- **Rollback coordinado** de datos y configuraciones

### **Mantenimiento Programado**
- **Configuraciones temporales** para modo mantenimiento
- **Rollback autom√°tico** despu√©s del mantenimiento
- **Notificaciones especiales** durante mantenimiento
- **Validaci√≥n completa** del sistema post-mantenimiento

## ‚öôÔ∏è **Configuraciones del Propio Sistema de Configuraci√≥n**

### **Meta-configuraciones**
- **Tiempo de monitoreo** post-cambio por nivel
- **Umbrales de alerta** para rollback autom√°tico
- **Retenci√≥n de historial** (cu√°nto tiempo mantener backups)
- **Notificaciones** del sistema de configuraci√≥n

### **Configuraciones de Seguridad**
- **Qui√©n puede cambiar** cada nivel de configuraci√≥n
- **Validaciones adicionales** requeridas
- **Confirmaciones m√∫ltiples** para cambios cr√≠ticos
- **Logs especiales** para cambios de seguridad

---

**Relacionado con**:
- [Workflow Security & Audit](/documentacion-tecnica/workflows/workflow-security-audit) - Para auditor√≠a de cambios de configuraci√≥n
- [Workflow Notifications](/documentacion-tecnica/workflows/workflow-notifications) - Para alertas de cambios cr√≠ticos
- [Workflow Users](/documentacion-tecnica/workflows/workflow-users) - Para permisos de configuraci√≥n por tipo de usuario