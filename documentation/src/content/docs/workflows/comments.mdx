---
title: Workflow - Comments and Feedback
description: Sistema de comentarios, feedback y comunicaci√≥n entre usuarios
---

# Workflow - Comments & Feedback

Sistema integral de comentarios y feedback para facilitar la comunicaci√≥n entre todos los actores del sistema.

## üí¨ **Sistema de Comentarios General**

## üîÑ **Flujos por Tipo de Entidad**

### **Comentarios en Tareas**

#### **Flujo b√°sico de comentarios en tareas**

```mermaid
graph TD
    A[Usuario ve tarea] --> B[Click en comentarios]
    B --> C[Escribir comentario]
    C --> D[Seleccionar tipo]
    D --> E{¬øMenciona usuarios?}
    E -->|S√≠| F[Procesar menciones]
    E -->|No| G[Guardar comentario]
    F --> G
    G --> H[Notificar involucrados]
    H --> I[Actualizar thread]
```

#### **Tipos de comentarios en tareas**:

| Tipo | Qui√©n puede | Cu√°ndo | Notifica a |
|------|-------------|--------|------------|
| **GENERAL** | Todos los involucrados | Cualquier momento | Asignados + Admin |
| **FEEDBACK** | Admin, Cliente | En revisiones | Colaborador + Admin |
| **APPROVAL** | Admin, Cliente | Al aprobar | Colaborador + equipo |
| **REJECTION** | Admin, Cliente | Al rechazar (obligatorio) | Colaborador + Admin |

#### **Permisos por user_type**:

| User Type | Ver comentarios | Crear comentarios | Ver internos | Mencionar usuarios |
|-----------|----------------|-------------------|--------------|-------------------|
| **Cliente** | Solo sus proyectos | ‚úÖ | ‚ùå | Solo su equipo |
| **Colaborador** | Tareas asignadas | ‚úÖ | ‚úÖ | Todo el equipo |
| **Admin** | Todos | ‚úÖ | ‚úÖ | Todos |
| **SuperAdmin** | Todos | ‚úÖ | ‚úÖ | Todos |

### **Comentarios en Proyectos**

#### **Comunicaci√≥n a nivel proyecto**

```mermaid
graph TD
    A[Usuario accede al proyecto] --> B[Ver timeline de comentarios]
    B --> C{¬øQuiere comentar?}
    C -->|S√≠| D[Escribir comentario general]
    C -->|No| E[Ver comentarios existentes]
    D --> F[Comentario visible para todo el equipo]
    F --> G[Notificaciones autom√°ticas]
    E --> H[Filtrar por tipo/usuario]
```

#### **Casos de uso espec√≠ficos**:
- **Actualizaciones de progreso** por Admin
- **Consultas del cliente** sobre el proyecto
- **Coordinaci√≥n entre colaboradores**
- **Cambios de alcance o fechas**

### **Comentarios en Solicitudes (Requests)**

#### **Comunicaci√≥n durante evaluaci√≥n**

```mermaid
graph TD
    A[Cliente env√≠a solicitud] --> B[Admin eval√∫a]
    B --> C{¬øNecesita m√°s info?}
    C -->|S√≠| D[Admin comenta con preguntas]
    C -->|No| E[Aprobaci√≥n/Rechazo]
    D --> F[Cliente ve comentario]
    F --> G[Cliente responde]
    G --> H[Actualizar solicitud]
    E --> I[Comentario de cierre obligatorio]
```

#### **Comentarios obligatorios**:
- **Al rechazar solicitud** ‚Üí Raz√≥n espec√≠fica
- **Al pedir m√°s informaci√≥n** ‚Üí Qu√© informaci√≥n falta
- **Al aprobar con condiciones** ‚Üí Condiciones espec√≠ficas

### **Comentarios en Entregables**

#### **Feedback espec√≠fico por archivo**

```mermaid
graph TD
    A[Revisor ve entregable] --> B[Abrir archivo/link]
    B --> C[Dejar feedback espec√≠fico]
    C --> D{¬øTipo de feedback?}
    D -->|Aprobaci√≥n| E[Comentario positivo]
    D -->|Cambios menores| F[Comentario con sugerencias]
    D -->|Rechazo| G[Comentario detallado obligatorio]
    E --> H[Marcar como aprobado]
    F --> I[Mantener en revisi√≥n]
    G --> J[Regresar a colaborador]
```

## üßµ **Sistema de Threading**

### **Conversaciones Anidadas**

#### **Estructura jer√°rquica**:
```
üìù Comentario principal (parent_comment_id = NULL)
  ‚Ü≥ üí¨ Respuesta 1 (parent_comment_id = comentario_principal.id)
    ‚Ü≥ üí¨ Respuesta a respuesta (parent_comment_id = respuesta_1.id)
  ‚Ü≥ üí¨ Respuesta 2 (parent_comment_id = comentario_principal.id)
```

#### **L√≠mites de anidamiento**:
- **M√°ximo 3 niveles** de profundidad
- **Auto-colapso** de hilos largos (m√°s de 5 respuestas)
- **Navegaci√≥n visual** con indentaci√≥n y l√≠neas

### **Flujo de Respuestas**

```mermaid
graph TD
    A[Usuario lee comentario] --> B[Click en Responder]
    B --> C[Verificar permisos]
    C --> D[Formulario de respuesta]
    D --> E[Escribir respuesta]
    E --> F[Enviar respuesta]
    F --> G[Notificar autor original]
    G --> H[Notificar menciones]
    H --> I[Actualizar thread]
```

## üë• **Sistema de Menciones**

### **Menciones con @usuario**

#### **Funcionamiento**:
- **Autocompletado** al escribir `@` + primeras letras
- **Validaci√≥n** de que el usuario tiene acceso a la entidad
- **Notificaci√≥n inmediata** al usuario mencionado
- **Highlighting** del nombre en el comentario

#### **Reglas de menciones**:

```json
{
  "CLIENT": {
    "puede_mencionar": ["colaboradores_del_proyecto", "admin_del_proyecto"],
    "puede_ser_mencionado": true
  },
  "COLLABORATOR": {
    "puede_mencionar": ["equipo_completo", "cliente_del_proyecto"],
    "puede_ser_mencionado": true
  },
  "ADMIN": {
    "puede_mencionar": ["todos_los_usuarios"],
    "puede_ser_mencionado": true
  },
  "SUPERADMIN": {
    "puede_mencionar": ["todos_los_usuarios"],
    "puede_ser_mencionado": true
  }
}
```

### **Notificaciones por Menciones**

```mermaid
graph TD
    A[Usuario escribe @nombre] --> B[Sistema valida usuario]
    B --> C[Guardar en mentions JSONB]
    C --> D[Enviar notificaci√≥n inmediata]
    D --> E[Email si est√° configurado]
    E --> F[Notificaci√≥n in-app]
    F --> G[Webhook si aplica]
```

## üìé **Archivos Adjuntos en Comentarios**

### **Soporte para Attachments**

#### **Tipos permitidos**:
- **Im√°genes**: JPG, PNG, GIF (hasta 5MB)
- **Documentos**: PDF, DOC, TXT (hasta 10MB)
- **Enlaces**: URLs v√°lidas con preview autom√°tico

#### **Flujo de subida**:

```mermaid
graph TD
    A[Usuario selecciona archivo] --> B[Validar tipo y tama√±o]
    B --> C[Subir a storage]
    C --> D[Generar URL segura]
    D --> E[Guardar en attachments JSONB]
    E --> F[Mostrar preview en comentario]
```

#### **Estructura de attachments**:
```json
{
  "attachments": [
    {
      "type": "image",
      "filename": "screenshot.png",
      "url": "https://storage.medialab/comments/abc123.png",
      "size": 1024000,
      "uploaded_at": "2024-01-15T10:30:00Z"
    },
    {
      "type": "link",
      "title": "Referencia de dise√±o",
      "url": "https://dribbble.com/shots/example",
      "preview_image": "https://cdn.dribbble.com/thumb.jpg"
    }
  ]
}
```

## ‚öôÔ∏è **Integraci√≥n con Flujo de Aprobaciones**

### **Comentarios Obligatorios en Rechazos**

#### **Flujo de rechazo con feedback**:

```mermaid
graph TD
    A[Revisor eval√∫a entregable] --> B{¬øAprueba?}
    B -->|No| C[Formulario de rechazo]
    C --> D[Comentario obligatorio]
    D --> E[Categorizar tipo de problema]
    E --> F[Enviar feedback]
    F --> G[Cambiar estado a RECHAZADO]
    G --> H[Notificar a colaborador]
    H --> I[Crear tarea de correcci√≥n]
```

#### **Categor√≠as de feedback**:
```json
{
  "categorias_rechazo": [
    {
      "code": "CALIDAD_TECNICA",
      "name": "Problemas de calidad t√©cnica",
      "descripcion": "Audio, video, resoluci√≥n, formato"
    },
    {
      "code": "CONTENIDO",
      "name": "Problemas de contenido",
      "descripcion": "Informaci√≥n incorrecta, falta contenido"
    },
    {
      "code": "ESPECIFICACIONES",
      "name": "No cumple especificaciones",
      "descripcion": "No sigue el brief o requerimientos"
    },
    {
      "code": "PRESENTACION",
      "name": "Problemas de presentaci√≥n",
      "descripcion": "Formato, estilo, branding"
    }
  ]
}
```

### **Comentarios en Aprobaciones**

#### **Feedback positivo y sugerencias**:
- **Aprobaci√≥n simple** ‚Üí Comentario opcional
- **Aprobaci√≥n con sugerencias** ‚Üí Comentario con mejoras para futuro
- **Aprobaci√≥n condicional** ‚Üí Comentario con condiciones espec√≠ficas

## üîî **Sistema de Notificaciones**

### **Triggers de Notificaciones**

#### **Eventos que generan notificaciones**:

| Evento | Notifica a | Tipo | Canal |
|--------|------------|------|-------|
| **Nuevo comentario** | Involucrados en la entidad | `COMMENT_ADDED` | In-app + Email |
| **Respuesta a comentario** | Autor del comentario padre | `COMMENT_REPLIED` | In-app + Email |
| **Menci√≥n en comentario** | Usuario mencionado | `COMMENT_MENTION` | In-app + Email |
| **Comentario editado** | Involucrados | `COMMENT_EDITED` | In-app |
| **Comentario resuelto** | Autor + involucrados | `COMMENT_RESOLVED` | In-app |

### **Configuraci√≥n de Notificaciones**

#### **Preferencias por usuario**:
```json
{
  "comment_notifications": {
    "new_comments": {
      "email": true,
      "in_app": true,
      "immediate": true
    },
    "mentions": {
      "email": true,
      "in_app": true,
      "immediate": true
    },
    "replies": {
      "email": false,
      "in_app": true,
      "immediate": false
    }
  }
}
```

## üìä **M√©tricas y Analytics**

### **KPIs de Comunicaci√≥n**

#### **Por usuario**:
- **Tiempo promedio de respuesta** a comentarios
- **Tasa de resoluci√≥n** de feedback
- **Calidad de feedback** (rating por receptores)
- **Participaci√≥n en conversaciones**

#### **Por proyecto**:
- **N√∫mero de comentarios** por fase
- **Tiempo de resoluci√≥n** de issues planteados
- **Satisfacci√≥n con comunicaci√≥n** (surveys)

### **Dashboard de Comentarios**

#### **M√©tricas en tiempo real**:
- **Comentarios pendientes de respuesta** por usuario
- **Threads m√°s activos** de la semana
- **Tiempo promedio de resoluci√≥n** por tipo de feedback
- **Usuarios m√°s activos** en comentarios

## üîß **Configuraciones del Sistema**

### **Configuraciones Cr√≠ticas** (tabla `configurations`)

| Key | Value | Descripci√≥n |
|-----|-------|-------------|
| `comments.max_length` | 2000 | M√°ximo caracteres por comentario |
| `comments.max_attachments` | 3 | M√°ximo archivos por comentario |
| `comments.edit_time_limit` | 30 | Minutos para editar comentario |
| `comments.threading_max_depth` | 3 | M√°ximo niveles de anidamiento |
| `comments.auto_resolve_days` | 7 | D√≠as para auto-resolver comentarios |
| `comments.mention_notification_delay` | 0 | Delay en segundos para notificaciones |

### **Moderaci√≥n y Control**

#### **Sistema de moderaci√≥n**:
- **Auto-moderaci√≥n** por palabras clave
- **Reportes de usuarios** por contenido inapropiado
- **Soft delete** con posibilidad de recuperaci√≥n
- **Historial de ediciones** para auditor√≠a

## üîÑ **Integraci√≥n con Otros Workflows**

### **Con Workflow Projects-Tasks**

#### **Comentarios autom√°ticos del sistema**:
```json
{
  "system_comments": [
    {
      "trigger": "task_status_changed",
      "template": "Estado cambiado de {old_status} a {new_status} por {user_name}",
      "type": "SYSTEM",
      "auto_create": true
    },
    {
      "trigger": "task_assigned",
      "template": "Tarea asignada a {assignee_name} por {admin_name}",
      "type": "SYSTEM",
      "auto_create": true
    },
    {
      "trigger": "deliverable_uploaded",
      "template": "Nuevo entregable subido: {filename}",
      "type": "SYSTEM",
      "auto_create": true
    }
  ]
}
```

### **Con Workflow Users**

#### **Gesti√≥n de comentarios de ex-empleados**:
- **Preservar comentarios** hist√≥ricos
- **Marcar como ex-empleado** en la visualizaci√≥n
- **Impedir nuevos comentarios** de usuarios desactivados
- **Reasignar ownership** de threads cr√≠ticos

### **Con Workflow Inventory**

#### **Comentarios en equipos**:
- **Reportes de problemas** directamente en comentarios
- **Historial de mantenimiento** con feedback t√©cnico
- **Comunicaci√≥n durante reservas** de equipos cr√≠ticos

## üöÄ **Caracter√≠sticas Avanzadas**

### **Templates de Comentarios**

#### **Plantillas predefinidas para feedback com√∫n**:
```json
{
  "feedback_templates": [
    {
      "name": "Calidad de video",
      "category": "TECNICO",
      "template": "La calidad del video necesita mejoras en:\n- [ ] Resoluci√≥n\n- [ ] Estabilizaci√≥n\n- [ ] Iluminaci√≥n\n- [ ] Audio\n\nComentarios espec√≠ficos:\n{comentario_personalizado}"
    },
    {
      "name": "Aprobaci√≥n con cambios menores",
      "category": "APROBACION",
      "template": "Excelente trabajo! Aprobado con estos cambios menores:\n{lista_cambios}\n\nPara futuros proyectos considerar:\n{sugerencias_futuro}"
    }
  ]
}
```

### **Rich Text Editor**

#### **Funcionalidades avanzadas**:
- **Formato b√°sico** (bold, italic, lists)
- **Menciones autom√°ticas** con @
- **Links autom√°ticos** con preview
- **C√≥digo inline** para feedback t√©cnico
- **Emojis** para comunicaci√≥n m√°s amigable

### **Historial y Auditor√≠a**

#### **Tracking completo**:
- **Todas las ediciones** con timestamp
- **Raz√≥n de edici√≥n** (opcional)
- **IP y dispositivo** de cada comentario
- **Tiempo de lectura** por usuario

---

**Relacionado con**:
- [Workflow Projects-Tasks](/documentacion-tecnica/workflows/workflow-projects-tasks) - Para comentarios en tareas y proyectos
- [Workflow Users](/documentacion-tecnica/workflows/workflow-users) - Para permisos y menciones de usuarios
- [Workflow Inventory](/documentacion-tecnica/workflows/workflow-inventory) - Para feedback en equipos