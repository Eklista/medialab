---
title: Workflow - Projects & Tasks
description: Flujos detallados desde solicitud hasta entrega final
---

# Flujos de Trabajo Completos

Documentaci√≥n detallada de todos los flujos de trabajo del sistema, desde solicitud inicial hasta entrega final.

## üîÑ **Flujo Principal: Solicitud ‚Üí Entrega**

### **Fase 1: Solicitud del Cliente**

#### **Estado Inicial: ENVIADO**
```mermaid
graph TD
    A[Cliente completa formulario] --> B[requests.status = ENVIADO]
    B --> C[Notificaci√≥n a Admins]
    C --> D[Admin eval√∫a solicitud]
```

**Actores**: Cliente  
**Duraci√≥n t√≠pica**: Inmediato  
**Notificaciones**: 
- Admin recibe notificaci√≥n `REQUEST_RECEIVED`
- Cliente recibe confirmaci√≥n de env√≠o

**Campos requeridos en solicitud**:
- `title` - T√≠tulo descriptivo
- `description` - Descripci√≥n detallada del servicio
- `service_type_id` - Tipo de servicio solicitado
- `priority_id` - Prioridad sugerida por cliente
- `requested_date` - Fecha deseada de entrega

#### **Evaluaci√≥n: EN_EVALUACION**
```mermaid
graph TD
    A[Admin revisa solicitud] --> B{¬øViable?}
    B -->|S√≠| C[APROBADO]
    B -->|No| D[RECHAZADO]
    B -->|Falta info| E[MAS_INFORMACION]
```

**Actores**: Admin  
**Duraci√≥n t√≠pica**: 1-3 d√≠as laborales  
**Decisiones posibles**:

##### ‚úÖ **APROBADO**
- Se convierte autom√°ticamente en proyecto
- `requests.converted_project_id` se llena
- Cliente recibe notificaci√≥n `REQUEST_APPROVED`
- Se crean tareas iniciales del proyecto

##### ‚ùå **RECHAZADO**
- **Comentario obligatorio** explicando raz√≥n
- Fin del proceso para esta solicitud
- Cliente recibe notificaci√≥n `REQUEST_REJECTED`
- No se puede reabrir, debe crear nueva solicitud

##### ‚ö†Ô∏è **MAS_INFORMACION**
- **Comentario obligatorio** especificando qu√© informaci√≥n falta
- Regresa a cliente para completar
- Cliente recibe notificaci√≥n `REQUEST_MORE_INFO`
- Cliente puede editar y reenviar (vuelve a `ENVIADO`)

**Casos Edge**:
- **Solicitud abandonada**: Si cliente no responde en 30 d√≠as ‚Üí Auto-rechazar
- **Admin sin respuesta**: Si no hay respuesta en 7 d√≠as ‚Üí Notificar SuperAdmin
- **Informaci√≥n incompleta repetida**: Si cliente env√≠a info incompleta 3 veces ‚Üí Escalar a reuni√≥n

### **Fase 2: Creaci√≥n del Proyecto**

#### **Conversi√≥n Autom√°tica**
Cuando una solicitud se aprueba:

```sql
-- Se crea el proyecto autom√°ticamente
INSERT INTO projects (
    name = request.title,
    description = request.description,
    client_id = request.client_id,
    service_type_id = request.service_type_id,
    priority_id = request.priority_id,
    status_id = (SELECT id FROM status_options WHERE code = 'SOLICITADO'),
    request_date = request.requested_date
)
```

**Estado inicial del proyecto**: `SOLICITADO`

#### **Planificaci√≥n: PLANIFICACION**
**Actores**: Admin  
**Duraci√≥n t√≠pica**: 1-2 d√≠as

**Tareas del Admin**:
1. **Asignar unidades participantes** (`project_units`)
2. **Crear tareas principales** basado en `service_type_id`
3. **Asignar colaboradores** a tareas
4. **Reservar equipos** necesarios
5. **Definir fechas** de inicio y entrega

**Auto-transici√≥n**: Cuando se crean las primeras tareas ‚Üí `EN_PROGRESO`

### **Fase 3: Ejecuci√≥n de Tareas (3 Niveles)**

#### **Nivel 1: Ejecuci√≥n por Colaborador**

##### **PENDIENTE ‚Üí EN_PROGRESO**
**Actores**: Colaborador asignado  
**Trigger**: Colaborador actualiza estado manualmente

```mermaid
graph TD
    A[Tarea PENDIENTE] --> B[Colaborador acepta]
    B --> C[Estado: EN_PROGRESO]
    C --> D[task_assignments.assignment_status = ACCEPTED]
```

**Notificaciones**:
- Admin recibe actualizaci√≥n de progreso
- Cliente recibe notificaci√≥n si es tarea visible

##### **EN_PROGRESO ‚Üí ENTREGADO**
**Actores**: Colaborador  
**Trigger**: Colaborador sube entregables y marca como entregado

**Requisitos para marcar ENTREGADO**:
- ‚úÖ Al menos 1 entregable subido (`deliverables`)
- ‚úÖ Todos los enlaces requeridos agregados (`task_links`)
- ‚úÖ Comentario opcional de entrega

**Auto-transici√≥n**: Al marcar ENTREGADO ‚Üí `EN_REVISION` (Nivel 2)

#### **Nivel 2: Revisi√≥n Interna**

##### **EN_REVISION**
**Actores**: Admin o SuperAdmin  
**Duraci√≥n t√≠pica**: 1-2 d√≠as

```mermaid
graph TD
    A[Tarea EN_REVISION] --> B[Revisor eval√∫a]
    B --> C{¬øCalidad OK?}
    C -->|S√≠| D[APROBADO]
    C -->|No| E[RECHAZADO]
```

**Requisitos para revisar**:
- Revisar todos los entregables
- Verificar calidad t√©cnica
- Validar que cumple especificaciones

##### **Decisiones del Revisor**:

**‚úÖ APROBADO**
- Entregable pasa a Nivel 3 (Cliente)
- Estado autom√°tico: `REVISION_CLIENTE`
- Cliente recibe notificaci√≥n para revisar

**‚ùå RECHAZADO**
- **Comentario obligatorio** con feedback espec√≠fico
- Regresa a `PENDIENTE` (Nivel 1)
- Colaborador recibe notificaci√≥n `TASK_REJECTED`
- Se mantiene historial de intentos en `task_approvals`

#### **Nivel 3: Revisi√≥n del Cliente**

##### **REVISION_CLIENTE**
**Actores**: Cliente original del proyecto  
**Duraci√≥n t√≠pica**: 2-5 d√≠as

**Cliente puede**:
- Ver todos los entregables
- Descargar archivos
- Acceder a enlaces (Drive, YouTube, etc.)
- Dejar comentarios espec√≠ficos

##### **Decisiones del Cliente**:

**‚úÖ APROBADO_CLIENTE**
- Tarea se marca como `COMPLETADO`
- Progreso del proyecto se actualiza autom√°ticamente
- Colaborador recibe notificaci√≥n `TASK_APPROVED`

**‚ùå RECHAZADO_CLIENTE**
- **Comentario obligatorio** con feedback del cliente
- Regresa a `EN_REVISION` (Nivel 2)
- Admin y colaborador reciben notificaci√≥n
- Admin debe decidir si acepta feedback o escala

**Casos Edge en Nivel 3**:
- **Cliente sin respuesta**: 7 d√≠as ‚Üí Recordatorio autom√°tico
- **Cliente sin respuesta**: 14 d√≠as ‚Üí Notificar Admin
- **Cliente sin respuesta**: 21 d√≠as ‚Üí Admin puede aprobar autom√°ticamente

### **Fase 4: Completado del Proyecto**

#### **C√°lculo Autom√°tico de Progreso**
```sql
-- F√≥rmula de progreso del proyecto
SELECT 
    (COUNT(*) FILTER (WHERE status_code IN ('APROBADO_CLIENTE', 'COMPLETADO')) * 100.0 / COUNT(*)) as progress_percentage
FROM tasks t
JOIN status_options so ON t.status_id = so.id
WHERE t.project_id = ?
```

#### **Estados Finales del Proyecto**:

**`COMPLETADO`**: Cuando 100% de tareas est√°n `APROBADO_CLIENTE`
- Cliente recibe notificaci√≥n `PROJECT_COMPLETED`
- Equipos se liberan autom√°ticamente
- Se generan m√©tricas finales del proyecto

**`EN_PAUSA`**: Solo por decisi√≥n manual de Admin
- Todas las tareas se pausan
- Equipos se liberan temporalmente
- Se programa fecha de reanudaci√≥n

**`CANCELADO`**: Solo por decisi√≥n de Admin o SuperAdmin
- Todas las tareas se cancelan
- Equipos se liberan inmediatamente
- Se registra raz√≥n de cancelaci√≥n

## üö® **Timeouts y Escalamiento Autom√°tico**

### **Timeouts por Fase**

| Fase | Actor | Timeout | Acci√≥n Autom√°tica |
|------|-------|---------|-------------------|
| Evaluaci√≥n solicitud | Admin | 7 d√≠as | Notificar SuperAdmin |
| Respuesta cliente (MAS_INFORMACION) | Cliente | 30 d√≠as | Auto-rechazar solicitud |
| Ejecuci√≥n de tarea | Colaborador | Fecha l√≠mite + 2 d√≠as | Notificar Admin |
| Revisi√≥n interna | Admin | 3 d√≠as | Recordatorio + escalamiento |
| Revisi√≥n cliente | Cliente | 21 d√≠as | Admin puede aprobar |

### **Escalamiento por Inactividad**

#### **Tareas Estancadas**
```mermaid
graph TD
    A[Tarea sin movimiento 5 d√≠as] --> B[Notificaci√≥n a responsable]
    B --> C[Sin respuesta 2 d√≠as]
    C --> D[Notificaci√≥n a Admin]
    D --> E[Admin puede reasignar]
```

#### **Proyectos en Riesgo**
**Criterios de riesgo**:
- ‚úÖ 50% de tareas vencidas
- ‚úÖ Sin progreso en 10 d√≠as
- ‚úÖ Cliente sin respuesta en m√∫ltiples tareas

**Acciones autom√°ticas**:
- Marcar proyecto como "EN RIESGO"
- Notificaci√≥n diaria a Admin
- Incluir en dashboard de alertas

## üîÑ **Flujos Especiales**

### **Reasignaci√≥n de Tareas**
**Triggers para reasignaci√≥n**:
- Colaborador solicita reasignaci√≥n
- Colaborador se va de licencia/vacaciones
- Admin detecta sobrecarga de trabajo
- Tarea requiere especialidad diferente

**Proceso de reasignaci√≥n**:
1. Admin selecciona nuevo colaborador
2. Sistema valida disponibilidad y especialidades
3. Se notifica a ambos colaboradores (anterior y nuevo)
4. Se preserva historial en `task_assignments`
5. Nuevo colaborador debe aceptar asignaci√≥n

### **Proyectos Urgentes**
**Criterios para urgencia**:
- `priority_id` = "URGENTE" o "CRITICA"
- Fecha de entrega en menos de 48 horas
- Marcado manualmente por SuperAdmin

**Flujo especial**:
- Revisi√≥n interna reducida a 4 horas
- Notificaciones inmediatas en cada cambio
- Prioridad alta en asignaci√≥n de equipos
- Dashboard especial para tracking

### **Proyectos de M√∫ltiples Fases**
Para proyectos grandes (ej: serie de podcast, curso completo):

**Estructura**:
- 1 Proyecto principal (`project_type = "PODCAST"`)
- N Episodios como sub-proyectos (`podcast_episodes`)
- Cada episodio tiene sus propias tareas

**Dependencias**:
- Episodio N+1 no puede empezar hasta que N est√© en `REVISION_CLIENTE`
- Equipos se pueden reservar en bloques
- Cliente aprueba episodio por episodio

## üìä **M√©tricas de Flujo**

### **KPIs por Fase**
- **Tiempo promedio de evaluaci√≥n**: Meta < 2 d√≠as
- **Tiempo promedio Nivel 1**: Meta seg√∫n tipo de servicio
- **Tiempo promedio Nivel 2**: Meta < 1 d√≠a
- **Tiempo promedio Nivel 3**: Meta < 3 d√≠as
- **% de rechazos por nivel**: Meta < 20%
- **% de proyectos completados a tiempo**: Meta > 90%

### **Alertas de Performance**
- ‚ö†Ô∏è **Amarilla**: KPI 20% por encima de meta
- üö® **Roja**: KPI 50% por encima de meta
- üî• **Cr√≠tica**: M√∫ltiples KPIs en rojo simult√°neamente

## üîß **Configuraciones del Flujo**

### **Configuraciones Cr√≠ticas** (tabla `configurations`)

| Key | Value | Descripci√≥n |
|-----|-------|-------------|
| `workflow.timeout.request_evaluation` | 7 | D√≠as para evaluar solicitud |
| `workflow.timeout.client_response` | 30 | D√≠as para respuesta cliente |
| `workflow.timeout.internal_review` | 3 | D√≠as para revisi√≥n interna |
| `workflow.timeout.client_review` | 21 | D√≠as para revisi√≥n cliente |
| `workflow.auto_approve_threshold` | 21 | D√≠as para auto-aprobaci√≥n |
| `workflow.escalation_enabled` | true | Activar escalamiento autom√°tico |
| `workflow.risk_criteria.overdue_percentage` | 50 | % tareas vencidas = riesgo |

### **Notificaciones por Flujo**

Cada transici√≥n de estado dispara notificaciones espec√≠ficas seg√∫n el tipo de usuario y configuraci√≥n personal del usuario en `user_notification_preferences`.

---

**Pr√≥ximos documentos a crear**:
- Sistema de Comentarios y Feedback
- Manejo de Conflictos y Concurrencia
- Gesti√≥n de Ex-empleados y Datos Hu√©rfanos