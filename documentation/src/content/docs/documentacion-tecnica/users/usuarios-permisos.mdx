---
title: Usuarios y Permisos
description: Sistema de usuarios, roles y permisos del sistema Medialab
---

# Usuarios y Permisos

Sistema de gesti√≥n de usuarios con 4 tipos principales y matriz de permisos granular.

## üë• Tipos de Usuario

### üåê Cliente (CLIENT)
**Acceso**: Portal cliente (`/portal/`)

**Caracter√≠sticas**:
- Usuario externo a la universidad
- Solo puede ver sus propios proyectos
- Puede crear solicitudes de servicio
- Recibe notificaciones de progreso

**Permisos**:
```json
{
  "portal": true,
  "create_requests": true,
  "view_own_projects": true,
  "comment_on_tasks": true,
  "approve_deliverables": true
}
```

### üë®‚Äçüíº Colaborador (COLLABORATOR)
**Acceso**: Dashboard interno (`/dashboard/`)

**Caracter√≠sticas**:
- Empleado de Medialab
- Ejecuta tareas asignadas
- Ve proyectos de su √°rea/especialidad
- Puede actualizar estados de tareas

**Permisos**:
```json
{
  "dashboard": true,
  "view_assigned_tasks": true,
  "update_task_status": true,
  "create_deliverables": true,
  "upload_files": true,
  "add_task_links": true,
  "view_team_projects": true,
  "manage_inventory_assignments": true,
  "create_time_logs": true
}
```

### üõ°Ô∏è Administrador (ADMIN)
**Acceso**: Dashboard interno (`/dashboard/`)

**Caracter√≠sticas**:
- Gestiona proyectos y equipos
- Aprueba/rechaza solicitudes
- Asigna tareas y recursos
- Ve reportes y m√©tricas

**Permisos**:
```json
{
  "dashboard": true,
  "all_collaborator_permissions": true,
  "manage_projects": true,
  "assign_tasks": true,
  "approve_requests": true,
  "manage_users": true,
  "view_reports": true,
  "manage_inventory": true,
  "create_projects": true
}
```

### üëë Super Administrador (SUPERADMIN)
**Acceso**: Godmode (`/godmode/`)

**Caracter√≠sticas**:
- Control total del sistema
- Gesti√≥n de configuraciones
- Acceso a logs y auditor√≠a
- Mantenimiento del sistema

**Permisos**:
```json
{
  "full_access": true,
  "system_configuration": true,
  "user_management": true,
  "audit_logs": true,
  "data_export": true,
  "backup_restore": true
}
```

## üóÇÔ∏è Estructura de Usuarios

### Informaci√≥n Base
| Campo | Cliente | Colaborador | Admin | SuperAdmin |
|-------|---------|-------------|-------|------------|
| name | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| email | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| phone | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| avatar_url | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |

### Informaci√≥n Laboral
| Campo | Cliente | Colaborador | Admin | SuperAdmin |
|-------|---------|-------------|-------|------------|
| employee_code | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| employee_role_id | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| position | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| hire_date | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| specialties | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| unit_id | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |

### Configuraci√≥n
| Campo | Cliente | Colaborador | Admin | SuperAdmin |
|-------|---------|-------------|-------|------------|
| is_internal | false | true | true | true |
| is_active | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| email_verified | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |

## üîê Matriz de Permisos por M√≥dulo

### üìù Requests (Solicitudes)
| Acci√≥n | Cliente | Colaborador | Admin | SuperAdmin |
|--------|---------|-------------|-------|------------|
| Crear solicitud | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |
| Ver propias solicitudes | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |
| Ver todas las solicitudes | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Evaluar solicitudes | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Convertir a proyecto | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |

### üìã Projects (Proyectos)
| Acci√≥n | Cliente | Colaborador | Admin | SuperAdmin |
|--------|---------|-------------|-------|------------|
| Ver proyectos propios | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |
| Ver proyectos asignados | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| Ver todos los proyectos | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Crear proyecto | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Editar proyecto | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Asignar unidades | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |

### ‚úÖ Tasks (Tareas)
| Acci√≥n | Cliente | Colaborador | Admin | SuperAdmin |
|--------|---------|-------------|-------|------------|
| Ver tareas de mis proyectos | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |
| Ver tareas asignadas | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| Crear tareas | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Asignar tareas | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Actualizar estado | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| Crear entregables | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| Subir archivos | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| Agregar enlaces | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| Aprobar/rechazar (Nivel 2) | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Aprobar/rechazar (Nivel 3) | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |

### üì¶ Inventory (Inventario)
| Acci√≥n | Cliente | Colaborador | Admin | SuperAdmin |
|--------|---------|-------------|-------|------------|
| Ver inventario | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| Reservar equipo | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| Gestionar equipos | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Crear/editar equipos | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Asignar equipos | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |

### üë• Users (Usuarios)
| Acci√≥n | Cliente | Colaborador | Admin | SuperAdmin |
|--------|---------|-------------|-------|------------|
| Ver perfil propio | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| Editar perfil propio | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| Ver otros usuarios | ‚ùå | ‚úÖ (equipo) | ‚úÖ | ‚úÖ |
| Crear usuarios | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Editar usuarios | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Desactivar usuarios | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |

### ‚öôÔ∏è System (Sistema)
| Acci√≥n | Cliente | Colaborador | Admin | SuperAdmin |
|--------|---------|-------------|-------|------------|
| Ver configuraciones | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| Editar configuraciones | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| Ver logs del sistema | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| Gestionar seeders | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| Backup/Restore | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |

## üîÑ Flujo de Autenticaci√≥n

### 1. Login
```mermaid
graph TD
    A[Usuario ingresa credenciales] --> B[Validar email/password]
    B --> C{¬øCredenciales v√°lidas?}
    C -->|No| D[Error de autenticaci√≥n]
    C -->|S√≠| E[Verificar usuario activo]
    E --> F{¬øUsuario activo?}
    F -->|No| G[Usuario desactivado]
    F -->|S√≠| H[Generar JWT token]
    H --> I[Redirigir seg√∫n user_type]
```

### 2. Redirecci√≥n por Tipo
```python
def redirect_after_login(user_type: str) -> str:
    redirects = {
        "CLIENT": "/portal/dashboard",
        "COLLABORATOR": "/dashboard/home", 
        "ADMIN": "/dashboard/admin",
        "SUPERADMIN": "/godmode/overview"
    }
    return redirects.get(user_type, "/")
```

### 3. Middleware de Permisos
```python
def check_permission(user: User, action: str, resource: str) -> bool:
    # SuperAdmin tiene acceso total
    if user.user_type.code == "SUPERADMIN":
        return True
    
    # Verificar permisos espec√≠ficos
    permissions = user.user_type.permissions
    return permissions.get(f"{action}_{resource}", False)
```

## üì± Gesti√≥n de Dispositivos

### Registro de Dispositivos
- **Autom√°tico**: Al hacer login desde nuevo dispositivo
- **Informaci√≥n capturada**: Browser, OS, IP, User Agent
- **Device fingerprint**: Para detecci√≥n de dispositivos

### Dispositivos Confiables
- **Marca como confiable**: Despu√©s de verificaci√≥n por email
- **Beneficios**: Login sin verificaci√≥n adicional
- **Gesti√≥n**: Usuario puede ver y revocar dispositivos

## üì± Gesti√≥n de Dispositivos y Seguridad

### Registro de Dispositivos
- **Autom√°tico**: Al hacer login desde nuevo dispositivo
- **Informaci√≥n capturada**: Browser, OS, IP, User Agent
- **Device fingerprint**: Para detecci√≥n de dispositivos

### Dispositivos Confiables
- **Marca como confiable**: Despu√©s de verificaci√≥n por email
- **Beneficios**: Login sin verificaci√≥n adicional
- **Gesti√≥n**: Usuario puede ver y revocar dispositivos

### Sistema de Bloqueos Inteligente

#### 1. Bloqueo por Usuario (Nivel 1)
| Intentos | Tiempo de Bloqueo | Almacenado en |
|----------|-------------------|---------------|
| 3 intentos fallidos | 5 minutos | Redis |
| 5 intentos fallidos | 30 minutos | Redis |
| 8 intentos fallidos | 2 horas | Redis |
| 10+ intentos | 24 horas | Redis + DB |

#### 2. Bloqueo por Dispositivo (Nivel 2)
**Criterio**: `user_agent + browser_fingerprint`
```json
{
  "device_id": "hash(user_agent + fingerprint)",
  "blocked_until": "2024-01-01T12:00:00Z",
  "attempts_count": 5,
  "reason": "multiple_failed_attempts"
}
```

#### 3. Bloqueo por IP (Nivel 3 - Solo casos extremos)
**Solo para**:
- **Ataques masivos**: +50 intentos en 10 minutos
- **IPs maliciosas conocidas**: Lista negra externa
- **Patrones de bot**: Comportamiento automatizado

#### 4. Bloqueo Total de IP (Nivel 4 - Cr√≠tico)
**Criterios**:
- **Ataque DDoS**: +200 requests/minuto
- **M√∫ltiples usuarios afectados**: +10 usuarios bloqueados desde misma IP
- **IP en blacklist**: Reportada como maliciosa

### Arquitectura de Redis
```redis
# Bloqueos por usuario
user_blocks:{user_id} = {
  "attempts": 3,
  "blocked_until": "timestamp",
  "last_attempt": "timestamp"
}

# Bloqueos por dispositivo  
device_blocks:{device_hash} = {
  "attempts": 5,
  "blocked_until": "timestamp",
  "user_agents": ["agent1", "agent2"]
}

# Bloqueos por IP (solo cr√≠ticos)
ip_blocks:{ip_address} = {
  "reason": "mass_attack",
  "blocked_until": "timestamp", 
  "affected_users": ["user1", "user2"]
}

# Rate limiting general
rate_limit:{ip}:{endpoint} = {
  "requests": 10,
  "window_start": "timestamp"
}
```

### Casos Especiales

#### Empresa con IP Compartida
**Problema**: Toda la empresa usa la misma IP p√∫blica
**Soluci√≥n**: 
- ‚úÖ Bloqueo por usuario individual
- ‚úÖ Bloqueo por dispositivo/fingerprint
- ‚ùå NO bloquear IP compartida
- ‚ö†Ô∏è Solo alerta si +20 usuarios fallan desde misma IP

#### Universidad con Red Interna
**Problema**: Laboratorios con PCs compartidas
**Soluci√≥n**:
- ‚úÖ Identificaci√≥n por user_agent + fingerprint
- ‚úÖ Permitir m√∫ltiples usuarios por dispositivo
- ‚úÖ Bloqueo individual por usuario
- ‚ö†Ô∏è Alerta si mismo dispositivo falla con m√∫ltiples usuarios

### Configuraci√≥n Inteligente
```python
# Configuraci√≥n din√°mica basada en contexto
SECURITY_CONFIG = {
    "internal_networks": ["192.168.", "10.0.", "172.16."],
    "university_ranges": ["200.37.64.", "190.12.34."],
    "known_shared_ips": ["201.123.45.67"],  # IPs empresariales conocidas
    
    "rules": {
        "internal_ip": {
            "user_attempts_limit": 10,  # M√°s tolerante en red interna
            "device_attempts_limit": 15,
            "ip_block_threshold": 100   # Muy alto para IPs internas
        },
        "external_ip": {
            "user_attempts_limit": 5,   # M√°s estricto externo
            "device_attempts_limit": 8,
            "ip_block_threshold": 20
        },
        "shared_known_ip": {
            "user_attempts_limit": 8,   # Balanceado para empresas
            "device_attempts_limit": 12,
            "ip_block_disabled": True   # Nunca bloquear IPs conocidas
        }
    }
}
```

### Alertas y Monitoreo
| Evento | Alerta a | Acci√≥n |
|--------|----------|--------|
| Usuario bloqueado 3+ veces | Admin | Email + Dashboard |
| +5 usuarios desde misma IP | SuperAdmin | Investigar posible compromiso |
| Patr√≥n de ataque detectado | SuperAdmin | Bloqueo autom√°tico + Log |
| IP externa con +50 intentos | SuperAdmin | Considerar bloqueo de IP |

### Recovery y Whitelist
- **Auto-recovery**: Bloqueos de usuario se levantan autom√°ticamente
- **Admin override**: Admins pueden desbloquear usuarios manualmente
- **IP Whitelist**: IPs de confianza nunca se bloquean
- **Emergency access**: C√≥digo de emergencia para SuperAdmin

## üîî Notificaciones por Tipo

### Cliente
- Nueva tarea en su proyecto
- Cambio de estado en tareas
- Solicitud de aprobaci√≥n de entregables
- Proyecto completado

### Colaborador  
- Nueva tarea asignada
- Cambio de prioridad en tareas
- Comentarios en sus tareas
- Equipos reservados/liberados

### Admin
- Nueva solicitud pendiente
- Tareas vencidas o en riesgo
- Problemas de inventario
- Reportes semanales

### SuperAdmin
- Errores del sistema
- Usuarios nuevos registrados
- Cambios en configuraci√≥n
- Alertas de seguridad

## üìä Especialidades por Rol

### Camar√≥grafo
```json
{
  "equipment": ["CAMARA", "AUDIO", "ILUMINACION"],
  "skills": ["grabacion_video", "fotografia", "streaming"],
  "certifications": []
}
```

### Editor
```json
{
  "software": ["premiere", "after_effects", "davinci"],
  "specialties": ["video_editing", "color_grading", "audio_mixing"],
  "formats": ["4K", "HD", "social_media"]
}
```

### Dise√±ador
```json
{
  "software": ["photoshop", "illustrator", "figma"],
  "specialties": ["graphic_design", "ui_ux", "branding"],
  "output_types": ["print", "digital", "web"]
}
```

## üîÑ Estados de Usuario

### Estados Generales
| Estado | Descripci√≥n | Puede hacer login |
|--------|-------------|-------------------|
| **Activo** | Usuario normal | ‚úÖ |
| **Inactivo** | Temporalmente deshabilitado | ‚ùå |
| **Pendiente** | Email no verificado | ‚ö†Ô∏è (limitado) |
| **Suspendido** | Violaci√≥n de pol√≠ticas | ‚ùå |

### Estados Espec√≠ficos para Colaboradores
| Estado | Descripci√≥n | Puede hacer login | Tareas asignadas |
|--------|-------------|-------------------|------------------|
| **Activo** | Empleado trabajando normalmente | ‚úÖ | Visible y editable |
| **Vacaciones** | Empleado en vacaciones | ‚úÖ | Visible, solo lectura |
| **Licencia** | Empleado en licencia m√©dica/personal | ‚ùå | Visible, reasignables |
| **Ex-empleado** | Ya no trabaja en el departamento | ‚ùå | Visible, solo lectura |

### Gesti√≥n de Ex-empleados
**Prop√≥sito**: Mantener historial sin eliminar datos

**Caracter√≠sticas**:
- **Login**: Bloqueado permanentemente
- **Tareas hist√≥ricas**: Visibles como "Creado por [Nombre] (Ex-empleado)"
- **Proyectos**: Historial conservado con nota de estado
- **Equipos**: Autom√°ticamente des-asignados
- **Nuevas asignaciones**: Imposibles

**Ventajas**:
- ‚úÖ Preserva historial de trabajo
- ‚úÖ Mantiene trazabilidad de tareas
- ‚úÖ No rompe relaciones de BD
- ‚úÖ Facilita auditor√≠as futuras